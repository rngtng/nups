- if newsletter.state?(:sending)
  = delayed_remote_function( :url => account_newsletter_path(*newsletter.route), :method => :get, :delay => 2000, :replace => "#status_#{newsletter.id}" )

%tr{ :id => "status_#{newsletter.id}", :class => "newsletter #{cycle('bgdark', 'bglight')} #{newsletter.state}" }
  %td.icon
    = newsletter.state
    %img

  %td.progress
    %strong
      #{l(newsletter.updated_at, :format => :nl)}:
    = link_to truncate(newsletter.subject, :length => 80), account_newsletter_path(*newsletter.route)

    -# .progress_bar
    -#   .progress{:style => "background-color: #{newsletter.errors_count > 0 ? 'red' : 'green'}; width: #{newsletter.progress_percent}px;"}
    -#     #{newsletter.progress_percent}%
    -# = l Time.at(newsletter.sending_time), :format => :time
    -# #{"%.1f" % newsletter.deliveries_per_second}/sec.
    -# - # color: white;' align='center'

  %td
    0 #{Newsletter.human_attribute_name(:recipients_count)}

  %td.actions
    %a.button.send_test{ :href => start_account_newsletter_path(*newsletter.route) }
      %span=t('newsletters.ctrl.send_test')
    %a.button.send_live{ :href => start_account_newsletter_path(*newsletter.route, :mode => 'live'), 'data-confirm' => t('newsletters.confirm.send_live') }
      %span=t('newsletters.ctrl.send_live')
    %a.button.resume{ :href => start_account_newsletter_path(*newsletter.route, :mode => 'live'), 'data-confirm' => t('newsletters.confirm.resume') }
      %span=t('newsletters.ctrl.resume')
    %a.button.stop{ :href => stop_account_newsletter_path(*newsletter.route), 'data-confirm' => t('newsletters.confirm.stop') }
      %span=t('newsletters.ctrl.stop')

  %td.menu
    = link_to image_tag('buttons/preview.png', :title => t('ctrl.preview')), newsletter.route, :class => 'preview'
    = link_to image_tag('buttons/edit.png',    :title => t('ctrl.edit')),    edit_account_newsletter_path(*newsletter.route), :class => 'edit'
    = link_to image_tag('buttons/delete.png',  :title => t('ctrl.delete')),  newsletter.route, :method => 'delete', :class => 'delete', :confirm => t('newsletters.confirm.delete')
